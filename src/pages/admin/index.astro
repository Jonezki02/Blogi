---
import AuthAdminLayout from "../../layouts/AuthAdminLayout.astro";
import { getAllPosts } from "../../lib/posts";

const sessionCookie = Astro.cookies.get("session");
if (sessionCookie?.value !== "unsecure_session") {
  return Astro.redirect("/admin/login");
}

const posts = getAllPosts();
---

<AuthAdminLayout>
  <h1>Articles</h1>
  <a href="/admin/posts/new">New article</a>

  <table>
    <thead>
      <tr>
        <th>Title</th>
        <th>Date</th>
        <th>Slug</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {
        posts.map((post) => (
          <tr>
            <td>
              <strong>{post.title}</strong>
            </td>
            <td>{new Date(post.date).toLocaleDateString("en-US")}</td>
            <td>
              <code>{post.slug}</code>
            </td>
            <td>
              <a href={`/admin/posts/${post.slug}`}>View</a>
              <a href={`/admin/posts/${post.slug}/edit`}>Edit</a>
              <a href={`/admin/posts/${post.slug}/delete`}>Delete</a>
            </td>
          </tr>
        ))
      }
      {posts.length === 0 && <p>No articles</p>}
    </tbody>
  </table>
</AuthAdminLayout>
