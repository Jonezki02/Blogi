---
import AdminLayout from "../../layouts/AdminLayout.astro";

const sessionCookie = Astro.cookies.get("session");
const isLoggedIn = sessionCookie?.value === "unsecure_session";

if (isLoggedIn) {
  return Astro.redirect("/admin");
}

let error = "";

if (Astro.request.method === "POST") {
  const formData = await Astro.request.formData();
  const username = formData.get("username") as string;
  const password = formData.get("password") as string;

  if (
    username === import.meta.env.ADMIN_USERNAME &&
    password === import.meta.env.ADMIN_PASSWORD
  ) {
    Astro.cookies.set("session", "unsecure_session", {
      path: "/",
      httpOnly: true,
      maxAge: 60 * 60 * 24,
    });
    return Astro.redirect("/admin");
  } else {
    error = "Invalid credentials";
  }
}
---

<AdminLayout>
  <div>
    <h1>Login</h1>
    {error && <div>{error}</div>}
    <form method="POST">
      <div>
        <label for="username">Username</label>
        <input type="text" id="username" name="username" required />
      </div>
      <div>
        <label for="password">Password</label>
        <input type="password" id="password" name="password" required />
      </div>
      <button type="submit">Login</button>
    </form>
  </div>
</AdminLayout>
